webpackJsonp([1],{"3e1r":function(t,e){},"6yKX":function(t,e){},J8qN:function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("IvJb"),s={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]};var i=n("C7Lr")({name:"App"},s,!1,function(t){n("k0XN")},null,null).exports,r=n("zO6J"),o={name:"PageHeader",data:function(){return{showLogin:!1,inputName:"",username:""}},mounted:function(){if(window.sessionStorage){var t=window.sessionStorage.getItem("username");null!=t&&""!=t&&(this.username=t,this.inputName=t,this.showLogin=!1,this.$store.commit("username/setUsername",t))}else alert("浏览器不支持sessionStorage!")},methods:{login:function(){this.showLogin=!0},hideLogin:function(){this.showLogin=!1},saveName:function(){window.sessionStorage?window.sessionStorage.setItem("username",this.inputName):alert("浏览器不支持sessionStorage!");this.username=this.inputName,this.showLogin=0,this.$store.commit("username/setUsername",this.inputName)}},directives:{focus:{inserted:function(t){t.focus()}}}},c={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[1==t.showLogin?n("div",{staticClass:"loginTotal"},[n("div",{staticClass:"loginHold",on:{click:t.hideLogin}}),t._v(" "),n("div",{staticClass:"loginBlock"},[n("p",[t._v("请输入你的用户名")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.inputName,expression:"inputName"},{name:"focus",rawName:"v-focus"}],attrs:{type:"text"},domProps:{value:t.inputName},on:{keydown:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.saveName(e):null},input:function(e){e.target.composing||(t.inputName=e.target.value)}}}),t._v(" "),n("br"),t._v(" "),n("button",{staticClass:"loginButton",on:{click:t.saveName}},[t._v("确认")])])]):t._e(),t._v(" "),n("div",{staticClass:"header"},[n("div",{staticClass:"header-content"},[n("div",{staticClass:"header-left"},[t._v("你画我猜")]),t._v(" "),n("div",{staticClass:"header-right"},[n("ul",[n("li",[""==t.username?n("a",{on:{click:t.login}},[t._v("登录")]):n("a",{on:{click:t.login}},[t._v("欢迎 "+t._s(t.username))])]),t._v(" "),t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2)])])])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("li",[e("a",{attrs:{href:"https://github.com/buppt",target:"_blank"}},[this._v("Github")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("li",[e("a",{attrs:{href:"https://github.com/buppt/canvas-websocket-learn",target:"_blank"}},[this._v("Star")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("li",[e("a",[this._v("多语言")])])}]};var u=n("C7Lr")(o,c,!1,function(t){n("pnKG")},"data-v-3ac3e07e",null).exports,d=n("AA3o"),l=n.n(d),h=n("xSur"),m=n.n(h),v={name:"DrawBoard",data:function(){return{draw:null,drawColor:"#000000",fillColor:"#000000",drawLineWidth:1,drawType:"画笔",lineEndType:"默认",lineNodeType:"默认"}},mounted:function(){this.draw=new p("drawBoard",this.$store.state.wsStore.ws),this.draw.draw()},watch:{drawColor:function(){this.draw.changeColor(this.drawColor)},drawLineWidth:function(){this.draw.changeLineWidth(this.drawLineWidth)},fillColor:function(){this.draw.changeFillColor(this.fillColor)},drawType:function(){"直线"==this.drawType?this.draw.drawLine():"矩形"==this.drawType?this.draw.drawRect():"圆"==this.drawType?this.draw.drawRound():this.draw.draw()},lineEndType:function(){this.draw.changeLineEnd({"默认":"butt","半圆":"round","矩形":"square"}[this.lineEndType])},lineNodeType:function(){this.draw.changeLineNode({"默认":"miter","半圆":"round","斜角":"bevel"}[this.lineNodeType])}},methods:{clearDraw:function(){this.draw.clearCanvas()}}},p=function(){function t(e,n){l()(this,t),this.ws=n,this.canvas=document.getElementById(e),this.ctx=this.canvas.getContext("2d"),this.stage_info=this.canvas.getBoundingClientRect(),this.path={beginX:0,beginY:0,endX:0,endY:0},this.isDraw=!1}return m()(t,[{key:"changeColor",value:function(t){this.ctx.strokeStyle=t}},{key:"changeLineWidth",value:function(t){this.ctx.lineWidth=t}},{key:"changeFillColor",value:function(t){this.ctx.fillStyle=t}},{key:"changeLineEnd",value:function(t){this.ctx.lineCap=t}},{key:"changeLineNode",value:function(t){this.ctx.lineJoin=t}},{key:"drawLine",value:function(){var t=this;this.canvas.onmousedown=function(){t.ctx.beginPath(),t.path.beginX=event.pageX-t.stage_info.left,t.path.beginY=event.pageY-t.stage_info.top,t.ctx.moveTo(t.path.beginX,t.path.beginY)},this.canvas.onmouseup=function(){t.path.endX=event.pageX-t.stage_info.left,t.path.endY=event.pageY-t.stage_info.top,t.ctx.lineTo(t.path.endX,t.path.endY),t.ctx.stroke()}}},{key:"drawRect",value:function(){var t=this;this.canvas.onmousedown=function(){t.ctx.beginPath(),t.path.beginX=event.pageX-t.stage_info.left,t.path.beginY=event.pageY-t.stage_info.top},this.canvas.onmouseup=function(){t.path.endX=event.pageX-t.stage_info.left,t.path.endY=event.pageY-t.stage_info.top,t.ctx.rect(t.path.beginX,t.path.beginY,t.path.endX-t.path.beginX,t.path.endY-t.path.beginY),t.ctx.fill(),t.ctx.stroke()}}},{key:"drawRound",value:function(){var t=this;this.canvas.onmousedown=function(){t.ctx.beginPath(),t.path.beginX=event.pageX-t.stage_info.left,t.path.beginY=event.pageY-t.stage_info.top},this.canvas.onmouseup=function(){t.path.endX=event.pageX-t.stage_info.left,t.path.endY=event.pageY-t.stage_info.top;var e=t.path.endX-t.path.beginX,n=t.path.endY-t.path.beginY;t.ctx.arc(t.path.beginX+e/2,t.path.beginY+n/2,Math.sqrt(e*e+n*n)/2,0,2*Math.PI),t.ctx.fill(),t.ctx.stroke()}}},{key:"draw",value:function(){var t=this;this.canvas.onmousedown=function(){t.ctx.beginPath(),t.path.beginX=event.pageX-t.stage_info.left,t.path.beginY=event.pageY-t.stage_info.top,t.ctx.moveTo(t.path.beginX,t.path.beginY),t.isDraw=!0},this.canvas.onmousemove=function(){t.isDraw&&t.drawing(event)},this.canvas.onmouseup=function(){t.isDraw=!1,t.ws.send("stop,")}}},{key:"drawing",value:function(t){this.path.endX=t.pageX-this.stage_info.left,this.path.endY=t.pageY-this.stage_info.top,this.ctx.lineTo(this.path.endX,this.path.endY),this.ctx.stroke(),this.ws.send("draw,"+this.path.beginX+","+this.path.beginY+","+this.path.endX+","+this.path.endY)}},{key:"clearCanvas",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ws.send("clear,")}}]),t}(),f={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"drawBoard"},[n("div",{staticClass:"canvasSetting"},[n("label",[n("input",{directives:[{name:"model",rawName:"v-model",value:t.drawType,expression:"drawType"}],attrs:{name:"drawType",type:"radio",value:"画笔"},domProps:{checked:t._q(t.drawType,"画笔")},on:{change:function(e){t.drawType="画笔"}}}),t._v("画笔 ")]),t._v(" "),n("br"),t._v(" "),n("label",[n("input",{directives:[{name:"model",rawName:"v-model",value:t.drawType,expression:"drawType"}],attrs:{name:"drawType",type:"radio",value:"直线"},domProps:{checked:t._q(t.drawType,"直线")},on:{change:function(e){t.drawType="直线"}}}),t._v("直线 ")]),t._v(" "),n("br"),t._v(" "),n("label",[n("input",{directives:[{name:"model",rawName:"v-model",value:t.drawType,expression:"drawType"}],attrs:{name:"drawType",type:"radio",value:"矩形"},domProps:{checked:t._q(t.drawType,"矩形")},on:{change:function(e){t.drawType="矩形"}}}),t._v("矩形 ")]),t._v(" "),n("br"),t._v(" "),n("label",[n("input",{directives:[{name:"model",rawName:"v-model",value:t.drawType,expression:"drawType"}],attrs:{name:"drawType",type:"radio",value:"圆"},domProps:{checked:t._q(t.drawType,"圆")},on:{change:function(e){t.drawType="圆"}}}),t._v("圆 ")]),t._v(" "),n("br"),t._v("\n\t\t\t填充颜色：\n\t\t\t"),n("input",{directives:[{name:"model",rawName:"v-model",value:t.fillColor,expression:"fillColor"}],attrs:{type:"color"},domProps:{value:t.fillColor},on:{input:function(e){e.target.composing||(t.fillColor=e.target.value)}}}),t._v(" "),n("br"),t._v("\n\t\t\t选择颜色：\n\t\t\t"),n("input",{directives:[{name:"model",rawName:"v-model",value:t.drawColor,expression:"drawColor"}],attrs:{type:"color"},domProps:{value:t.drawColor},on:{input:function(e){e.target.composing||(t.drawColor=e.target.value)}}}),t._v(" "),n("br"),t._v("\n\t\t\t笔粗细\n\t\t\t"),n("input",{directives:[{name:"model",rawName:"v-model",value:t.drawLineWidth,expression:"drawLineWidth"}],attrs:{type:"range",min:"1",max:"10"},domProps:{value:t.drawLineWidth},on:{__r:function(e){t.drawLineWidth=e.target.value}}}),t._v(t._s(t.drawLineWidth)+"\n            "),n("br"),t._v("\n\t\t\t线端点类型\n\t\t\t"),n("select",{directives:[{name:"model",rawName:"v-model",value:t.lineEndType,expression:"lineEndType"}],on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.lineEndType=e.target.multiple?n:n[0]}}},[n("option",[t._v("默认")]),t._v(" "),n("option",[t._v("半圆")]),t._v(" "),n("option",[t._v("矩形")])]),t._v(" "),n("br"),t._v("\n\t\t\t矩形角类型\n\t\t\t"),n("select",{directives:[{name:"model",rawName:"v-model",value:t.lineNodeType,expression:"lineNodeType"}],on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.lineNodeType=e.target.multiple?n:n[0]}}},[n("option",[t._v("默认")]),t._v(" "),n("option",[t._v("半圆")]),t._v(" "),n("option",[t._v("斜角")])])]),t._v(" "),n("canvas",{attrs:{id:"drawBoard",width:"700",height:"400"}}),t._v(" "),n("button",{staticClass:"clearButton",on:{click:function(e){t.clearDraw()}}},[t._v("clear")])]),t._v(" "),n("br")])},staticRenderFns:[]};var w=n("C7Lr")(v,f,!1,function(t){n("r92p")},"data-v-aad9a672",null).exports,g={name:"ShowBoard",data:function(){return{canvas:"",ctx:"",draw:"",isDraw:1}},mounted:function(){this.canvas=document.getElementById("showing"),this.ctx=this.canvas.getContext("2d"),this.ctx.strokeStyle="#000"},watch:{msg:function(t,e){"draw"==this.msg[0]||"stop"==this.msg[0]?(1==this.isDraw&&"stop"!=this.msg[0]?(this.ctx.beginPath(),this.ctx.moveTo(this.msg[1],this.msg[2]),this.isDraw=0):0==this.isDraw&&"stop"==this.msg[0]&&(this.isDraw=1),this.ctx.lineTo(this.msg[3],this.msg[4]),this.ctx.stroke()):"clear"==this.msg[0]&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}},computed:{msg:function(){return this.$store.state.wsStore.draw}},methods:{clearDraw:function(){this.draw.clearCanvas()}}},_={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("canvas",{attrs:{id:"showing",width:"650",height:"400"}})])}]};var b=n("C7Lr")(g,_,!1,function(t){n("joPs")},"data-v-06f2f235",null).exports,y=n("HzJ8"),C=n.n(y),x={name:"TheSeats",data:function(){return{buttonShow:"空位"}},mounted:function(){},computed:{username:function(){return this.$store.state.username.username},seats:function(){return this.$store.state.wsStore.seats},beginGame:function(){return this.$store.state.beginGame.beginGame},drawuser:function(){return this.$store.state.beginGame.drawUser}},watch:{beginGame:function(t,e){var n=document.querySelectorAll('button[component="seat"]');if(this.beginGame){var a=!0,s=!1,i=void 0;try{for(var r,o=C()(n);!(a=(r=o.next()).done);a=!0){r.value.setAttribute("disabled","disabled")}}catch(t){s=!0,i=t}finally{try{!a&&o.return&&o.return()}finally{if(s)throw i}}}else{var c=!0,u=!1,d=void 0;try{for(var l,h=C()(n);!(c=(l=h.next()).done);c=!0){l.value.removeAttribute("disabled")}}catch(t){u=!0,d=t}finally{try{!c&&h.return&&h.return()}finally{if(u)throw d}}}}},methods:{seatDown:function(t){3!=this.$store.state.wsStore.ws.readyState?null==this.username||""==this.username?this.$message("请登陆"):"空位"==this.seats[t]?this.$store.state.wsStore.ws.send("seats,"+t+","+this.username):this.$message("此位置有人"):this.$message("服务器未连接")},begin:function(){this.$store.state.wsStore.ws.send("begin,")}}},k={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"seatContent"},[n("div",{staticClass:"startButton"},[t.seats[0]==t.username?n("button",{attrs:{component:"seat"},on:{click:function(e){t.begin()}}},[t._v("开始游戏")]):n("button",{attrs:{component:"seat"},on:{click:function(e){t.seatDown(0)}}},[t._v("一楼房主")]),t._v(" "),n("div",{staticClass:"clear"})]),t._v(" "),t._l(t.seats,function(e,a){return n("div",{key:a,staticClass:"seats-block"},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.beginGame&&t.drawuser==e,expression:"beginGame&&drawuser==seat"}],staticClass:"drawuser"},[t._v("画")]),t._v(" "),n("button",{staticClass:"seat-num",class:"空位"==e?"blue":"green",attrs:{type:"primary",plain:"",component:"seat"},on:{click:function(e){t.seatDown(a)}}},[t._v(t._s(e))])])})],2)},staticRenderFns:[]};var T={name:"ChatBoard",data:function(){return{chatRecords:[{username:"haha",content:"大家好"},{username:"我是谁",content:"我是"},{username:"haha",content:"nihaoa"},{username:"我是谁",content:"haha"},{username:"haha",content:"nihaoa"},{username:"我是谁",content:"猜错了"}]}},watch:{msg:function(t,e){var n={username:this.msg[1],content:this.msg[2]};this.chatRecords.push(n);var a=document.getElementById("totalBoard");a.scrollTop=a.scrollHeight,console.log(a.scrollTop,a.scrollHeight+100)}},computed:{msg:function(){return this.$store.state.wsStore.chat}},methods:{clearScreen:function(){this.chatRecords=[]}}},S={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"totalBoard",attrs:{id:"totalBoard"}},[t._l(t.chatRecords,function(e,a){return n("div",{key:a,staticClass:"record"},[n("span",{staticClass:"blue"},[t._v(t._s(e.username))]),t._v(":"+t._s(e.content)+"\n    ")])}),t._v(" "),n("div",{staticClass:"blank"})],2),t._v(" "),n("button",{staticClass:"clearScreen",on:{click:t.clearScreen}},[t._v("清屏")])])},staticRenderFns:[]};var $={name:"ChatBoard",data:function(){return{guassWord:""}},computed:{username:function(){return this.$store.state.username.username},drawuser:function(){return this.$store.state.beginGame.drawUser}},watch:{drawuser:function(t,e){var n=document.querySelector('input[component="inputBoard"]'),a=document.querySelector('button[component="inputBoard"]');this.drawuser==this.username?(n.setAttribute("disabled","disabled"),a.setAttribute("disabled","disabled")):(n.removeAttribute("disabled"),a.removeAttribute("disabled"))}},methods:{submitWord:function(){3!=this.$store.state.wsStore.ws.readyState?null!=this.username&&""!=this.username?""!=this.guassWord&&(this.$store.state.wsStore.ws.send("chat,"+this.username+","+this.guassWord),this.guassWord=""):this.$message("请登陆"):this.$message("服务器未连接")}}},N={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"totalBoard"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.guassWord,expression:"guassWord"}],staticClass:"inputContent",attrs:{type:"text",placeholder:"这里输入内容",component:"inputBoard"},domProps:{value:t.guassWord},on:{keydown:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.submitWord(e):null},input:function(e){e.target.composing||(t.guassWord=e.target.value)}}}),t._v(" "),n("el-button",{staticClass:"submitButton",attrs:{type:"primary",component:"inputBoard"},on:{click:t.submitWord}},[t._v("发送")])],1)])},staticRenderFns:[]};var L={name:"HomeContent",components:{DrawBoard:w,ShowBoard:b,TheSeats:n("C7Lr")(x,k,!1,function(t){n("aFzW")},"data-v-d7e22d10",null).exports,ChatBoard:n("C7Lr")(T,S,!1,function(t){n("3e1r")},"data-v-0f082938",null).exports,InputBoard:n("C7Lr")($,N,!1,function(t){n("V+Lp")},"data-v-13100371",null).exports},data:function(){return{x:1,second:9}},computed:{username:function(){return this.$store.state.username.username},drawuser:function(){return this.$store.state.beginGame.drawUser},beginGame:function(){return this.$store.state.beginGame.beginGame},guassWord:function(){return this.$store.state.beginGame.drawWord}},watch:{drawuser:function(t,e){console.log(t),this.second=9,this.countDown()}},methods:{draw:function(){this.x=!this.x},countDown:function(){if(this.second>0){var t=this;setTimeout(function(){t.second--,t.countDown()},1e3)}}}},X={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"homeContent"},[n("div",{staticClass:"boardleft"},[n("div",{staticClass:"showBoard"},[t.beginGame?n("div",[t._v("当前画家："+t._s(t.drawuser)+"  剩余时间："+t._s(t.second))]):n("div",[t._v("请等待一楼开始游戏")]),t._v(" "),t.beginGame&&t.drawuser!=t.username?n("show-board"):n("draw-board"),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.beginGame&&t.drawuser==t.username,expression:"beginGame&&drawuser==username"}],staticClass:"guassWord"},[t._v("要画的词是："+t._s(t.guassWord))])],1),t._v(" "),n("the-seats",{staticClass:"seat"})],1),t._v(" "),n("div",{staticClass:"boardright"},[n("chat-board",{staticClass:"chatBoard"}),t._v(" "),n("input-board",{staticClass:"inputBoard"})],1),t._v(" "),n("div",{staticClass:"clear"})])},staticRenderFns:[]};var Y={name:"HomePage",components:{HomeHeader:u,HomeContent:n("C7Lr")(L,X,!1,function(t){n("J8qN")},"data-v-0b8d492c",null).exports},data:function(){return{}},mounted:function(){var t=new WebSocket("ws://localhost:3000/");this.$store.commit("wsStore/connect",t);var e=this;t.onmessage=function(t){var n=t.data.split(",");"seats"==n[0]?e.$store.commit("wsStore/changeSeats",n.slice(1,7)):"chat"==n[0]&&3==n.length?e.$store.commit("wsStore/acceptChat",n):"draw"==n[0]||"stop"==n[0]||"clear"==n[0]?e.$store.commit("wsStore/acceptDraw",n):"begin"!=n[0]&&"end"!=n[0]||e.$store.commit("beginGame/countDown",n)}},destroyed:function(){this.$store.state.wsStore.ws.onclose()}},B={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"homePage"},[e("home-header"),this._v(" "),e("home-content")],1)},staticRenderFns:[]};var W=n("C7Lr")(Y,B,!1,function(t){n("6yKX")},"data-v-b0bfaa90",null).exports;a.default.use(r.a);var E=new r.a({routes:[{path:"/",name:"HomePage",component:W}]}),G=n("9rMa"),D={namespaced:!0,state:{username:"",count:0},mutations:{getUsername:function(t){return t.username},setUsername:function(t,e){t.username=e},increment:function(t,e){t.count+=e}}},P={namespaced:!0,state:{ws:null,seats:["空位","空位","空位","空位","空位","空位"],chat:[],draw:[]},mutations:{connect:function(t,e){t.ws=e},changeSeats:function(t,e){t.seats=e},acceptChat:function(t,e){t.chat=e},acceptDraw:function(t,e){t.draw=e}}},R={namespaced:!0,state:{beginGame:!1,drawUser:"",drawWord:""},mutations:{countDown:function(t,e){"begin"==e[0]?(t.beginGame=!0,t.drawUser=e[1],t.drawWord=e[2]):"end"==e[0]&&(t.beginGame=!1)}}};a.default.use(G.a);var A=new G.a.Store({modules:{username:D,wsStore:P,beginGame:R},strict:!1}),H=n("H93t"),F=n.n(H);n("TsY+");a.default.config.productionTip=!1,a.default.use(G.a),a.default.use(F.a),new a.default({el:"#app",router:E,store:A,components:{App:i},template:"<App/>"})},"TsY+":function(t,e){},"V+Lp":function(t,e){},aFzW:function(t,e){},joPs:function(t,e){},k0XN:function(t,e){},pnKG:function(t,e){},r92p:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.6ed59c76e15b30c620b9.js.map